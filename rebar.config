%% Top-level rebar.config drives the build of all of our applications and
%% dependencies. This configuration file is applied to all applications that we
%% compile.
%%
%% Rebar3 will, by default, compile all applications in
%% ["apps/*","lib/*","."], this configuration parameter is known as
%% project_app_dirs.

{erl_opts, [{src_dirs, ["src"]}, debug_info, warnings_as_errors,
            {feature, maybe_expr, enable}]}.

{profiles, [
  {test, [
    {deps, [
      {meck, "0.9.2"},
      {triq, "1.3.0"}
    ]},

    {erl_opts, [{extra_src_dirs, ["test"]}]}
  ]}]}.

%% Rebar does not detect that it needs to rebuild escripts, so we need to tell
%% it to do so via artifacts declarations. Paths are relative to where you're
%% building though, and the build directory of an escript is always relative to
%% the top level directory. This means that we need to override the path to
%% something relative to us...
{overrides, [
    {override, chronicle, [{artifacts, ["../../bin/chronicle_dump"]}]}
]}.
